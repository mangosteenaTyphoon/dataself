# OKR-Todo 测试数据准备

## 📋 测试数据说明

本文档提供 OKR-Todo 系统的测试数据 SQL 脚本，用于快速准备测试环境。

---

## 🗄️ 测试数据库配置

### 建议使用独立的测试数据库

```sql
-- 创建测试数据库
CREATE DATABASE IF NOT EXISTS dataself_test DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;

-- 使用测试数据库
USE dataself_test;
```

---

## 📊 测试数据 SQL

### 1. 测试用户说明

**使用现有用户数据，不需要插入新用户**：
- 用户ID: 1, 用户名: admin（管理员）
- 用户ID: 4, 用户名: demo（演示用户）

**注意**：测试数据将使用这两个已存在的用户，不会修改用户表数据。

---

### 2. 目标测试数据

```sql
-- 清空现有测试数据（仅清理测试用户的数据）
DELETE FROM todo_goal WHERE user_id IN (1, 4);

-- 插入测试目标数据
INSERT INTO todo_goal (
    goal_id, user_id, title, description, status, priority, 
    progress, score, expected_start_time, expected_end_time, 
    actual_start_time, actual_end_time, summary, tags, 
    create_by, create_time, update_by, update_time, remark, del_flag
) VALUES
-- admin用户（user_id=1）的目标数据
(1, 1, '2026年Q1技术提升目标', '提升Java和微服务架构能力，掌握Spring Boot 3.x新特性', 
 'IN_PROGRESS', 'HIGH', 40, NULL, 
 '2026-01-01 00:00:00', '2026-03-31 23:59:59', 
 '2026-01-01 09:00:00', NULL, NULL, '技术,学习,Java', 
 'admin', NOW(), '', NULL, '第一季度技术提升计划', '0'),

(2, 1, '学习微服务架构', '深入学习Spring Cloud微服务架构', 
 'NOT_STARTED', 'MEDIUM', 0, NULL, 
 '2026-02-01 00:00:00', '2026-04-30 23:59:59', 
 NULL, NULL, NULL, '技术,微服务', 
 'admin', NOW(), '', NULL, '微服务学习计划', '0'),

(3, 1, '完成项目重构', '重构现有项目代码，提升代码质量', 
 'COMPLETED', 'HIGH', 100, 88.50, 
 '2025-10-01 00:00:00', '2025-12-31 23:59:59', 
 '2025-10-01 09:00:00', '2025-12-28 18:00:00', '项目重构完成，代码质量显著提升', '项目,重构', 
 'admin', '2025-10-01 09:00:00', 'admin', '2025-12-28 18:00:00', '项目重构任务', '0'),

(4, 1, '学习前端框架', '学习Vue 3和React', 
 'DRAFT', 'LOW', 0, NULL, 
 '2026-03-01 00:00:00', '2026-05-31 23:59:59', 
 NULL, NULL, NULL, '前端,学习', 
 'admin', NOW(), '', NULL, '前端学习计划', '0'),

-- demo用户（user_id=4）的目标数据
(5, 4, '提升团队协作能力', '学习敏捷开发和团队管理', 
 'IN_PROGRESS', 'MEDIUM', 30, NULL, 
 '2026-01-01 00:00:00', '2026-06-30 23:59:59', 
 '2026-01-05 09:00:00', NULL, NULL, '管理,团队', 
 'demo', NOW(), '', NULL, '团队管理提升', '0');
```

---

### 3. 任务测试数据

```sql
-- 清空现有测试数据（仅清理测试用户的数据）
DELETE FROM todo_task WHERE user_id IN (1, 4);

-- 插入测试任务数据
INSERT INTO todo_task (
    task_id, goal_id, user_id, title, description, status, priority, 
    score, expected_start_time, expected_end_time, 
    actual_start_time, actual_end_time, summary, sort_order, 
    create_by, create_time, update_by, update_time, remark, del_flag
) VALUES
-- 目标1的任务（admin用户，user_id=1）
(1, 1, 1, '学习Spring Boot 3.x新特性', '深入学习Spring Boot 3.x的新特性和最佳实践', 
 'COMPLETED', 'HIGH', 'EXCELLENT', 
 '2026-01-01 00:00:00', '2026-01-15 23:59:59', 
 '2026-01-01 09:00:00', '2026-01-14 18:00:00', '完成Spring Boot 3.x学习，掌握核心特性', 1, 
 'admin', NOW(), 'admin', '2026-01-14 18:00:00', 'Spring Boot学习任务', '0'),

(2, 1, 1, '学习Spring Cloud微服务', '学习Spring Cloud微服务组件', 
 'COMPLETED', 'HIGH', 'GOOD', 
 '2026-01-16 00:00:00', '2026-01-31 23:59:59', 
 '2026-01-16 09:00:00', '2026-01-30 18:00:00', '完成Spring Cloud学习', 2, 
 'admin', NOW(), 'admin', '2026-01-30 18:00:00', 'Spring Cloud学习任务', '0'),

(3, 1, 1, '实践微服务项目', '使用Spring Cloud搭建微服务项目', 
 'IN_PROGRESS', 'HIGH', NULL, 
 '2026-02-01 00:00:00', '2026-02-28 23:59:59', 
 '2026-02-01 09:00:00', NULL, NULL, 3, 
 'admin', NOW(), '', NULL, '微服务实践任务', '0'),

(4, 1, 1, '学习Docker容器化', '学习Docker和容器化部署', 
 'NOT_STARTED', 'MEDIUM', NULL, 
 '2026-03-01 00:00:00', '2026-03-15 23:59:59', 
 NULL, NULL, NULL, 4, 
 'admin', NOW(), '', NULL, 'Docker学习任务', '0'),

(5, 1, 1, '学习Kubernetes', '学习K8s容器编排', 
 'NOT_STARTED', 'MEDIUM', NULL, 
 '2026-03-16 00:00:00', '2026-03-31 23:59:59', 
 NULL, NULL, NULL, 5, 
 'admin', NOW(), '', NULL, 'K8s学习任务', '0'),

-- 目标3的任务（admin用户，已完成的目标）
(6, 3, 1, '代码重构-服务层', '重构Service层代码', 
 'COMPLETED', 'HIGH', 'EXCELLENT', 
 '2025-10-01 00:00:00', '2025-10-31 23:59:59', 
 '2025-10-01 09:00:00', '2025-10-28 18:00:00', '服务层重构完成', 1, 
 'admin', '2025-10-01 09:00:00', 'admin', '2025-10-28 18:00:00', '服务层重构', '0'),

(7, 3, 1, '代码重构-控制器层', '重构Controller层代码', 
 'COMPLETED', 'HIGH', 'GOOD', 
 '2025-11-01 00:00:00', '2025-11-30 23:59:59', 
 '2025-11-01 09:00:00', '2025-11-28 18:00:00', '控制器层重构完成', 2, 
 'admin', '2025-11-01 09:00:00', 'admin', '2025-11-28 18:00:00', '控制器层重构', '0'),

(8, 3, 1, '单元测试补充', '补充单元测试用例', 
 'COMPLETED', 'MEDIUM', 'QUALIFIED', 
 '2025-12-01 00:00:00', '2025-12-15 23:59:59', 
 '2025-12-01 09:00:00', '2025-12-14 18:00:00', '单元测试补充完成', 3, 
 'admin', '2025-12-01 09:00:00', 'admin', '2025-12-14 18:00:00', '单元测试', '0'),

(9, 3, 1, '代码审查和优化', '进行代码审查并优化', 
 'COMPLETED', 'MEDIUM', 'GOOD', 
 '2025-12-16 00:00:00', '2025-12-28 23:59:59', 
 '2025-12-16 09:00:00', '2025-12-28 18:00:00', '代码审查完成', 4, 
 'admin', '2025-12-16 09:00:00', 'admin', '2025-12-28 18:00:00', '代码审查', '0'),

-- 目标5的任务（demo用户，user_id=4）
(10, 5, 4, '学习敏捷开发方法', '学习Scrum和看板方法', 
 'COMPLETED', 'HIGH', 'GOOD', 
 '2026-01-05 00:00:00', '2026-01-20 23:59:59', 
 '2026-01-05 09:00:00', '2026-01-19 18:00:00', '敏捷开发学习完成', 1, 
 'demo', NOW(), 'demo', '2026-01-19 18:00:00', '敏捷开发学习', '0'),

(11, 5, 4, '团队管理实践', '在团队中实践敏捷方法', 
 'IN_PROGRESS', 'HIGH', NULL, 
 '2026-01-21 00:00:00', '2026-03-31 23:59:59', 
 '2026-01-21 09:00:00', NULL, NULL, 2, 
 'demo', NOW(), '', NULL, '团队管理实践', '0'),

(12, 5, 4, '团队沟通技巧提升', '提升团队沟通和协作能力', 
 'NOT_STARTED', 'MEDIUM', NULL, 
 '2026-04-01 00:00:00', '2026-06-30 23:59:59', 
 NULL, NULL, NULL, 3, 
 'demo', NOW(), '', NULL, '沟通技巧提升', '0');
```

---

## 🔍 数据验证 SQL

### 验证目标数据

```sql
-- 查询所有目标
SELECT goal_id, user_id, title, status, priority, progress, score
FROM todo_goal
WHERE del_flag = '0'
ORDER BY user_id, goal_id;

-- 统计各状态目标数量
SELECT status, COUNT(*) as count
FROM todo_goal
WHERE del_flag = '0'
GROUP BY status;
```

### 验证任务数据

```sql
-- 查询所有任务
SELECT task_id, goal_id, user_id, title, status, priority, score
FROM todo_task
WHERE del_flag = '0'
ORDER BY goal_id, sort_order;

-- 统计各目标的任务数量
SELECT goal_id, COUNT(*) as task_count,
       SUM(CASE WHEN status = 'COMPLETED' THEN 1 ELSE 0 END) as completed_count
FROM todo_task
WHERE del_flag = '0'
GROUP BY goal_id;
```

### 验证目标进度

```sql
-- 验证目标1的进度计算
SELECT 
    g.goal_id,
    g.title,
    g.progress as current_progress,
    COUNT(t.task_id) as total_tasks,
    SUM(CASE WHEN t.status = 'COMPLETED' THEN 1 ELSE 0 END) as completed_tasks,
    ROUND(SUM(CASE WHEN t.status = 'COMPLETED' THEN 1 ELSE 0 END) * 100.0 / COUNT(t.task_id), 2) as calculated_progress
FROM todo_goal g
LEFT JOIN todo_task t ON g.goal_id = t.goal_id AND t.del_flag = '0'
WHERE g.goal_id = 1 AND g.del_flag = '0'
GROUP BY g.goal_id, g.title, g.progress;
```

---

## 🧹 清理测试数据

### 清理所有测试数据

```sql
-- 清理任务数据（仅清理测试用户的数据）
DELETE FROM todo_task WHERE user_id IN (1, 4);

-- 清理目标数据（仅清理测试用户的数据）
DELETE FROM todo_goal WHERE user_id IN (1, 4);

-- 重置自增ID（可选）
ALTER TABLE todo_task AUTO_INCREMENT = 1;
ALTER TABLE todo_goal AUTO_INCREMENT = 1;
```

---

## 📊 测试数据统计

### 数据量统计

| 数据类型 | admin(ID=1) | demo(ID=4) | 总计 |
|---------|-------------|------------|------|
| 目标 | 4 | 1 | 5 |
| 任务 | 9 | 3 | 12 |

### 状态分布

**目标状态分布**：
- DRAFT: 1
- NOT_STARTED: 1
- IN_PROGRESS: 2
- COMPLETED: 1
- NOT_ACHIEVED: 0
- ARCHIVED: 0

**任务状态分布**：
- NOT_STARTED: 3
- IN_PROGRESS: 2
- COMPLETED: 7
- NOT_ACHIEVED: 0

---

## ⚠️ 注意事项

1. **用户数据**：使用现有用户 admin(ID=1) 和 demo(ID=4)，不会修改用户表
2. **时间数据**：部分时间使用了过去和未来的日期，用于测试不同场景
3. **数据隔离**：建议使用独立的测试数据库
4. **数据清理**：测试完成后及时清理测试数据
5. **ID冲突**：如果目标或任务ID已存在，请修改SQL中的ID值
6. **原有数据**：清理脚本仅删除测试用户(ID=1和4)的数据，不影响其他用户

---

## 🔄 快速重置脚本

```bash
#!/bin/bash
# 快速重置测试数据

# 数据库配置
DB_HOST="localhost"
DB_PORT="3306"
DB_NAME="dataself_test"
DB_USER="root"
DB_PASS="your_password"

# 清理数据（仅清理测试用户的数据）
mysql -h$DB_HOST -P$DB_PORT -u$DB_USER -p$DB_PASS $DB_NAME << EOF
DELETE FROM todo_task WHERE user_id IN (1, 4);
DELETE FROM todo_goal WHERE user_id IN (1, 4);
EOF

# 导入测试数据
mysql -h$DB_HOST -P$DB_PORT -u$DB_USER -p$DB_PASS $DB_NAME < 测试数据准备.sql

echo "测试数据重置完成！"
```

---

**文档版本**：v1.0.0  
**最后更新**：2026-01-11
